# ROS task flow (基于ROS系统的机器人任务流框架)

首先，任何一个**复杂的机器人任务流程**都可以拆分成依次进行**多个简单的子任务**，而这些子任务可以归类为四个功能模块即视觉模块，语音模块，导航模块以及机械臂模块。以物体抓取任务为例，对于任务整体的描述为：机器人导航进入指定房间，然后抓取目标物体。而这一过程可以拆分为：1. 机器人导航到指定地点。2. 机器人在指定地点搜索检测目标物体。3. 机器人在三维空间中定位目标物体。3. 移动机器人底盘到合适的抓取位置。4. 控制机械臂完成对指定物体的抓取。**通过对复杂任务进行拆分，可以最大程度地将不同的功能节点进行解耦，进而最大程度上实现功能模块的复用，避免了重复开发造成的时间浪费**。

如果想要实现上述构想，那么有两个必须解决的主要问题：**第一，如何简化不同功能模块之间的组合**。**第二，如何对不同的消息类型，任务结果进行统一的表述**。对于第一个重点，我目前的想法是：对于每一个任务，将其拆分为一系列多个简单的任务之后，通过一个控制节点(control node)控制视觉，导航，语音以及机械臂模块节点的开启与关闭来形成整个任务的流程，然后通过这个控制节点向功能模块发布任务，并且，控制节点接收来自功能模块的结果反馈，根据不同的结果选择下一步采取的行为。这一控制节点---->功能模块的机制类似于使用话题(Topic)的通信机制来模拟ROS自带的服务(Service)通信机制。这样设计的优势在于，对于不同的任务，可以快速设计新的控制节点，完成整个任务流程的构建，开发难度大大降低。对于第二个重点，**我目前的想法是对每一个子任务以及任务的结果进行抽象**。以对任务抽象为例，任何子任务可以抽象为机器人对目标(Target)执行一个行为(Action)，为了区分不同目标(Target)，我们需要对目标的属性进行描述，因为目标的多样性，目标的属性应该包含多个类别：人类目标，物体目标，导航目标，语音目标，机械臂目标，视觉目标。然后每类目标具有不同的属性。以简单的子任务为例，**导航任务**=机器人导航(Action=navigate)到目标点(Target=location)，目标点具有的属性是名称(Name)，或者坐标(geometry_msgs::Pose); **物体检测任务**=机器人检测(Action=detect)目标物体(Target=object), 目标物体具有的属性是类别(Class/Name)，颜色(Color)，形状(Shape); **语音识别任务**=机器人识别(Action=speech_recognition)目标录音文件(Target=audio)，目标录音文件具有的属性是文件名(File Name); **机械臂任务**=机器人控制机械臂末端执行器(Action=manipulate/grasp/release)到空间中的目标点(Target=space_coordinates)，目标点具有的属性是三维空间中的位置和姿态描述(xyz，rpy)。

解决了上述两个主要问题后，针对新的任务进行开发，开发演示样例，或者是用户自行尝试开发，就可以大大得到简化，用户需要熟悉掌握的就是我们抽象出来的子任务描述和任务结果描述。在控制节点的主循环中用户只需要像搭积木一样插入想要添加的功能模块，然后在回调函数中对功能模块的工作结果进行接受和处理就可以。

**目前需要完善的是对于子任务描述以及任务结果的抽象，如何尽可能地涵盖所有可能的任务，又避免过于臃肿。以及如何使控制节点主循环对用户更加友好。以及如何在回调函数中处理任务反馈才能使这种模式更加通用。**



